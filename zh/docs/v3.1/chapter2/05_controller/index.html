<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.82.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>展示层 | Macula</title><meta property="og:title" content="展示层"><meta property="og:description" content="本文介绍展示层的开发过程"><meta property="og:type" content="article"><meta property="og:url" content="/zh/docs/v3.1/chapter2/05_controller/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-05-01T19:02:57+08:00"><meta property="og:site_name" content="Macula"><meta itemprop=name content="展示层"><meta itemprop=description content="本文介绍展示层的开发过程"><meta itemprop=dateModified content="2021-05-01T19:02:57+08:00"><meta itemprop=wordCount content="1626"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="展示层"><meta name=twitter:description content="本文介绍展示层的开发过程"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-00000000-0','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preload href=/scss/main.min.52aacab82c063dce3f819e8497df4c2bb1491ef3d5cf721391a219516446870d.css as=style><link href=/scss/main.min.52aacab82c063dce3f819e8497df4c2bb1491ef3d5cf721391a219516446870d.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/zh/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">Macula</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/zh/docs/><span class=active>文档</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/blog/><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center d-lg-none"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">文档</a></li><ul><li class="collapse show" id=zhdocs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v3.1/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Macula 3.1</a></li><ul><li class="collapse show" id=zhdocsv31><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v3.1/chapter1/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">第一章</a></li><ul><li class=collapse id=zhdocsv31chapter1><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter101_introduction href=/zh/docs/v3.1/chapter1/01_introduction/>概述</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter102_quick_start href=/zh/docs/v3.1/chapter1/02_quick_start/>快速开始</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter103_project_building href=/zh/docs/v3.1/chapter1/03_project_building/>项目构建</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter104_release_nodes href=/zh/docs/v3.1/chapter1/04_release_nodes/>版本发布</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v3.1/chapter2/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">第二章</a></li><ul><li class="collapse show" id=zhdocsv31chapter2><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter201_configuration href=/zh/docs/v3.1/chapter2/01_configuration/>配置文件</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter201_dynaconfig href=/zh/docs/v3.1/chapter2/01_dynaconfig/>统一动态属性配置</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter202_project_start href=/zh/docs/v3.1/chapter2/02_project_start/>项目集成</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter202_domain href=/zh/docs/v3.1/chapter2/02_domain/>领域模型层</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter203_repository href=/zh/docs/v3.1/chapter2/03_repository/>数据存取层</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter204_service href=/zh/docs/v3.1/chapter2/04_service/>业务服务层</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-zhdocsv31chapter205_controller href=/zh/docs/v3.1/chapter2/05_controller/>展示层</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter206_timezone href=/zh/docs/v3.1/chapter2/06_timezone/>时间设置</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter207_exception href=/zh/docs/v3.1/chapter2/07_exception/>异常处理</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter208_cache href=/zh/docs/v3.1/chapter2/08_cache/>缓存服务</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter209_junit href=/zh/docs/v3.1/chapter2/09_junit/>单元测试</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter210_event href=/zh/docs/v3.1/chapter2/10_event/>事件机制</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v3.1/chapter3/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">第三章</a></li><ul><li class=collapse id=zhdocsv31chapter3><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter301_plugins_app href=/zh/docs/v3.1/chapter3/01_plugins_app/>应用相关</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter302_plugins_dataset href=/zh/docs/v3.1/chapter3/02_plugins_dataset/>数据相关</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter304_plugins-user href=/zh/docs/v3.1/chapter3/04_plugins-user/>用户相关</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter305_plugins_authentication href=/zh/docs/v3.1/chapter3/05_plugins_authentication/>用户认证</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter305_plugins_security href=/zh/docs/v3.1/chapter3/05_plugins_security/>安全相关</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter306_plugins_authority href=/zh/docs/v3.1/chapter3/06_plugins_authority/>权限管理</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter307_plugins_policy href=/zh/docs/v3.1/chapter3/07_plugins_policy/>业务策略</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter308_plugins_expr href=/zh/docs/v3.1/chapter3/08_plugins_expr/>表达式解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter310_openapi href=/zh/docs/v3.1/chapter3/10_openapi/>OpenAPI</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v3.1/chapter4/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">第四章</a></li><ul><li class=collapse id=zhdocsv31chapter4><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter401_webapp href=/zh/docs/v3.1/chapter4/01_webapp/>WEB应用基础</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter402_admin href=/zh/docs/v3.1/chapter4/02_admin/>后台管理</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter403_mda href=/zh/docs/v3.1/chapter4/03_mda/>表单与查询</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter404_rule href=/zh/docs/v3.1/chapter4/04_rule/>规则引擎</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter405_workflow href=/zh/docs/v3.1/chapter4/05_workflow/>工作流</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter406_dubbo href=/zh/docs/v3.1/chapter4/06_dubbo/>Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter407_esb href=/zh/docs/v3.1/chapter4/07_esb/>ESB</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter408_mq href=/zh/docs/v3.1/chapter4/08_mq/>阿里MQ</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter409_monitor href=/zh/docs/v3.1/chapter4/09_monitor/>系统监控</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v3.1/chapter5/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">第五章</a></li><ul><li class=collapse id=zhdocsv31chapter5><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter501_standard_code href=/zh/docs/v3.1/chapter5/01_standard_code/>Java代码规范</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter502_standard_check href=/zh/docs/v3.1/chapter5/02_standard_check/>代码审计规范</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter503_standard_junit href=/zh/docs/v3.1/chapter5/03_standard_junit/>单元测试标准</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter504_standard_library href=/zh/docs/v3.1/chapter5/04_standard_library/>第三方包使用标准</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter505_standard_import href=/zh/docs/v3.1/chapter5/05_standard_import/>新技术引入标准</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v3.1/chapter6/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">第六章</a></li><ul><li class=collapse id=zhdocsv31chapter6><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv31chapter601_tables href=/zh/docs/v3.1/chapter6/01_tables/>表结构</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v4.0/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Macula 4.0</a></li><ul><li class=collapse id=zhdocsv40><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v4.0/preface/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">序言</a></li><ul><li class=collapse id=zhdocsv40preface></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v4.0/quickstart/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">快速开始</a></li><ul><li class=collapse id=zhdocsv40quickstart><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv40quickstart01_environment href=/zh/docs/v4.0/quickstart/01_environment/>环境准备</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv40quickstart02_projects href=/zh/docs/v4.0/quickstart/02_projects/>项目搭建</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsv40quickstart03_run href=/zh/docs/v4.0/quickstart/03_run/>项目运行</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v4.0/feature/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">基本特性</a></li><ul><li class=collapse id=zhdocsv40feature></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v4.0/advance/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">高级实战</a></li><ul><li class=collapse id=zhdocsv40advance></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v4.0/production/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">生产部署</a></li><ul><li class=collapse id=zhdocsv40production></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/v4.0/upgrade/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">版本升级</a></li><ul><li class=collapse id=zhdocsv40upgrade></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/notices/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">公告栏</a></li><ul><li class=collapse id=zhdocsnotices><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsnoticessecurity href=/zh/docs/notices/security/>安全漏洞</a></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/macula-projects/macula-projects.github.io/edit/master/content/zh/docs/v3.1/chapter2/05_Controller.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/macula-projects/macula-projects.github.io/new/master/content/zh/docs/v3.1/chapter2/05_Controller.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/macula-projects/macula-projects.github.io/issues/new?title=%e5%b1%95%e7%a4%ba%e5%b1%82" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/macula-projects/macula-framework/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a>
<a id=print href=/zh/docs/v3.1/chapter2/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><nav id=TableOfContents><ul><li><a href=#controller编写>Controller编写</a><ul><li><a href=#使用基类controller>使用基类Controller</a></li><li><a href=#表单校验valid>表单校验@Valid</a></li><li><a href=#表单绑定formbean>表单绑定@FormBean</a></li><li><a href=#html表单input-name与后端参数转换规则>HTML表单input name与后端参数转换规则</a></li><li><a href=#pageable参数绑定>Pageable参数绑定</a></li><li><a href=#id到domain类型转换>ID到Domain类型转换</a></li><li><a href=#excelview>ExcelView</a></li></ul></li><li><a href=#freemarker模板编写>Freemarker模板编写</a><ul><li><a href=#页面布局>页面布局</a></li><li><a href=#页面布局宏的定义>页面布局宏的定义</a></li><li><a href=#后端页面布局定制>后端页面布局定制</a></li><li><a href=#前端页面布局定制>前端页面布局定制</a></li><li><a href=#ui宏>UI宏</a></li></ul></li><li><a href=#前端开发框架>前端开发框架</a></li><li><a href=#macula宏>Macula宏</a><ul><li><a href=#权限判断>权限判断</a></li><li><a href=#下拉框>下拉框</a></li><li><a href=#避免重复提交的token>避免重复提交的Token</a></li></ul></li><li><a href=#freemarker内置变量>FreeMarker内置变量</a><ul><li><a href=#登录用户信息>登录用户信息</a></li><li><a href=#菜单变量>菜单变量</a></li><li><a href=#freemarker内置方法>Freemarker内置方法</a></li></ul></li><li><a href=#国际化>国际化</a></li><li><a href=#地址规划>地址规划</a></li><li><a href=#请求方式规划>请求方式规划</a></li><li><a href=#restful-api>RESTful API</a><ul><li><a href=#rest数据返回格式>REST数据返回格式</a></li></ul></li><li><a href=#heading></a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/zh/docs/>文档</a></li><li class=breadcrumb-item><a href=/zh/docs/v3.1/>Macula 3.1</a></li><li class=breadcrumb-item><a href=/zh/docs/v3.1/chapter2/>第二章</a></li><li class="breadcrumb-item active" aria-current=page><a href=/zh/docs/v3.1/chapter2/05_controller/>展示层</a></li></ol></nav><div class=td-content><h1>展示层</h1><div class=lead>本文介绍展示层的开发过程</div><p>在Macula开发平台下，建议使用Spring MVC + Freemarker的方式来实现展现层。</p><p>同时对于Ajax部分，在javascript框架中建议使用jquery框架。</p><h2 id=controller编写>Controller编写</h2><h3 id=使用基类controller>使用基类Controller</h3><p>在展示层编写的Controller实现，需要直接或间接扩展至BaseController</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;admin/macula-base&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>AdminMaculaBaseController</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>BaseController</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>//something
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>在BaseController中处理了大量的异常处理方式以及数据返回要求的设定。</p><h3 id=表单校验valid>表单校验@Valid</h3><p>在Controller中的参数中，使用@FormBean注解来绑定页面数据到Bean，如果转换失败，则失败结果会出现在BindingResult中</p><p>在Controller中的参数中，使用@Valid注解来检查页面数据到Domain数据是否符合校验规则，校验规则的定义是在Bean中完成的，采用JSR-303的Bean Validator标准定义。校验失败的结果同样保存在BindingResult中</p><p>失败结果可以通过BaseController中的getMergedBindingResults方法得到，具体使用请参考BaseController类的使用说明。</p><h3 id=表单绑定formbean>表单绑定@FormBean</h3><p>在Spring MVC默认的基础上，Macula开发平台在参数绑定上做了适当扩展，以适应与Struts（Webwork）等相同的对参数处理的一致性，具体来说，有如下的变化：</p><ol><li><p>Bean参数绑定</p><p>默认情况下，String MVC对参数的绑定方式，采用直接属性名与给定POJO属性名相同的方式实现绑定，为了更好的区分具体的参数信息，Macula平台扩展了这类绑定，允许</p><pre><code>pojo名+ . + 属性名
</code></pre><p>的方式绑定。</p><p><strong>例 1. 两种绑定的区别</strong></p><p>比如在Controller中，会传入用户信息保存，其Controller原型为：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span> <span style=color:#000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>// something
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>;</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>此时客户端提交的参数信息为：</p><pre><code>?userName=Wilson&amp;password=123456
</code></pre><p>此时Spring自动将userName和password绑定生成User对象。但这种方式在返回多个对象时不太适用，所以Macula平台通过扩展，可通过修改Controller中的原型为：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span> <span style=color:#000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@Valid</span> <span style=color:#5c35cc;font-weight:700>@FormBean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>){</span>
   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>hasErrors</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FormBindException</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getMergedBindingResults</span><span style=color:#ce5c00;font-weight:700>());</span>
   <span style=color:#ce5c00;font-weight:700>}</span>

   <span style=color:#8f5902;font-style:italic>// something
</span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>;</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>通过Macula平台扩展后的提交的数据格式，将可以通过下面提交方式绑定：</p><pre><code>?user.userName=Wilson&amp;user.password=123456
</code></pre><p>为实现这个扩展，主要在于applicationContext-mvc.xml文件中的BeanArgumentResolver定义：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customArgumentResolvers&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
       <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
           <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.FormBeanArgumentResolver&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
               <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
           <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
       <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</code></pre></div><p>通过对自定义参数的解析，可以实现上述的变化。</p><p><em><strong>重要</strong></em></p><p><em>需要注意的是，使用Macula平台的绑定方式的前提是：必须使用@FormBean前缀，并且不能使用诸如@ModelAttribute、@RequestBody等Spring的绑定注解。</em></p></li><li><p>FormBean的表单防重复提交</p><p>在Form提交时，为了防止用户对表单的重复提交，除了使用客户端脚本控制按钮的状态外，平台提供了防重复提交的解决方案。</p><p>一般情况下，防重复提交有2个应用场景：<strong>1)防止用户无意识的重复提交；2)防止用户恶意的重复提交。</strong></p><p>对于无意识的提交，只需要在页面隐藏一个唯一性的Token，在表单提交时返回，在服务端校验并销毁即可完成对Token的验证而阻止该提交。</p><p>对于用户可能存在的恶意提交，可通过在表单提交时，插入验证码的方式来进行，用户必须正确输入了验证码，并在服务端校验成功后，才能进行业务逻辑的处理。</p><p>在平台实现的方式上，采用在FormBean注解中加入属性：</p><p>valid：(boolean)是否需要检测重复提交；</p><p>token：(String)在表单页面中提交的参数名称，默认值为ftoken，除非与业务中的字段冲突，否则不需要设置为其他值；</p><p>captcha：(boolean)是否检测验证码，来防止恶意提交</p><p>整个校验过程由FormBeanArgumentResolver完成。</p><p>相应的，在界面层面，需要配合在表单中加入防重复提交信息，在macula.ftl中提供了freemarker宏的默认实现。在该默认实现情况下，可通过在表单位置加入&lt;@macula.formToken />即可，对于需要加入校验码的情况下，使用&lt;@macula.formToken captcha=true /></p><p>具体的实现可参考macula.ftl文件。</p><p><em><strong>重要</strong></em></p><p><em>主要注意在同一个RequestMapping的方法中，如果有多个通过@FormBean注释的参数，在第一个使用FormBean注释的参数中加入该特性即可，其他不要加。<br>特别地，加入了自动控制防重复提交后，生成的客户端token只能进行一次校验即失效，所以在提交后，如果表单需要再次提交，需要更新隐藏的token的值。在默认情况下，调用$(form).trigger(&lsquo;changeCaptcha&rsquo;)即可更新，如果需要定制，可参考macula.ftl中的实现，做自定义的宏来处理。</em></p></li></ol><h3 id=html表单input-name与后端参数转换规则>HTML表单input name与后端参数转换规则</h3><p>本节继续上级讲解复杂的@FormBean对象是如何与HTML表单数据绑定的，假如：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#5c35cc;font-weight:700>@OpenApi</span>
<span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(...)</span>
<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>saveUser</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@FormBean</span> <span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>User类如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>password</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Org</span> <span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Org</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>orgs</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Org</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>girls</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>date</span><span style=color:#ce5c00;font-weight:700>;</span>
<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Org</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>;</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>那么HTML表单中input框的name应该如下命名：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.userName&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.password&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.org.code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.orgs[0].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.orgs[1].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.params[&#39;key1&#39;]&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.params[&#39;key2&#39;]&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.girls[&#39;key1&#39;].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.girls[&#39;key2&#39;].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
<span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.date&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</code></pre></div><ul><li><p>原子类型：例如long,int,String等，需要形成“参数名=值”的键值对传递；</p></li><li><p>POJO对象：如User，需要形成“参数名.属性名=值”的键值对传递；</p></li><li><p>原子类型数组：如String[]、List，需要形成“参数名=值0”、“参数名=值1”等的键值对传递；</p></li><li><p>POJO对象数组：如User[]、List，需要形成“参数名[index].属性名=值”等的键值对，index为数组下标；</p></li><li><p>Map：需要形成“参数名[key]=值”的键值对传递；</p></li><li><p>Map：需要形成“参数名[key].属性名=值”的键值对传递；</p></li><li><p>对于POJO对象中如果含有POJO数组、Map、POJO则规则同上，而原子类型数组需要写成“属性名[index]=值”。</p></li></ul><h3 id=pageable参数绑定>Pageable参数绑定</h3><p>在使用了Spring-Data框架够，对于多数分页式查询，可通过直接传入Pageable参数和额外的参数条件，即可返回包括总记录数、当前页面记录等信息的Page对象返回，对于Controller层，方便的获得页面传递的Pageable参数并构造成相应的对象值，也是一种代码简洁和易用性上的提升。</p><p>对于Pageable参数的绑定，比如Controller中编写：</p><ol><li><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/test/user/list&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RequestMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GET</span><span style=color:#ce5c00;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Pageable</span> <span style=color:#000>pageable</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>userRespository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>pageable</span><span style=color:#ce5c00;font-weight:700>);</span>
    <span style=color:#8f5902;font-style:italic>// other coding...
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>;</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>为了实现这个扩展，主要在applicationContext-mvc.xml文件中的PageableArgumentResolver定义：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;messageConverters&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;messageConverters&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customArgumentResolvers&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
      <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
          <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.PageableArgumentResolver&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>           
      <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</code></pre></div><p>Pageable参数绑定时，将直接从Request参数中获取，如果在一个方法中，需要构建多个Pageable对象，可通过@Qualifier来指定别名，这样在Request中获取属性 别名+ &ldquo;_&rdquo; + 属性名，来构建Pageable对象。</p><p>request参数包括：page(页码)、rows(每页行数)、sort(按什么排序,格式是field1,field2&mldr;,asc或者desc，可以多个sort参数，最后一个表示排序类型)</p><p><em><strong>重要</strong></em></p><p><em>这里Pageable与Bean构建的区别在于，默认情况下Pageable直接从Request中获取数据，而在通过@Qualifier指定别名时，Bean的属性获取规则是 别名+ &ldquo;.&rdquo; + 属性名，而Pageable的规则是 别名+ &ldquo;_</em>&rdquo; +属性名。</p></li></ol><h3 id=id到domain类型转换>ID到Domain类型转换</h3><p>很多情况下，在编辑时或者在查看详细信息时，总是通过传入一个主键值（通常是Long型），来获取具体的记录信息，在Macula平台中，为了简化这种操作，对于已定义的Domain类，可以通过已定义的ConversionService直接转换。</p><p>对应的applicationContext-mvc.xml中配置如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;conversionService&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.format.support.FormattingConversionServiceFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;converters&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
          <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
              <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.RepositoryConverter&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
          <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
      <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
   <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</code></pre></div><p>配置该转化后，需要转化的类型必须实现Persistable接口，并且定义了相对应的JpaRepository，否则也不能正常转换。</p><p><em><strong>重要</strong></em></p><p><em>除了加入该ConversionService外，还需要注意：</em></p><ul><li><p><em>普通的VO对象不要实现Persistable接口，即不能使用该转换</em></p></li><li><p><em>待转化类必须实现Persistable接口</em></p></li><li><p><em>该转换Domain对象，在Spring上下文中，已经定义了相应的JpaRepository Bean，用来通过主键载入该对象值</em></p><p><em><strong>例 2. 通过传入主键，直接转化为相应的对象</strong></em></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/test/user/{userId}/edit&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RequestMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GET</span><span style=color:#ce5c00;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span> <span style=color:#000>edit</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@PathVariable</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;userId&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>;</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>如上面的Controller中的定义可见，传入的userId是一个字符串（或者可以认为是Long型），但在edit方法中，可直接定义为User user，即由macula平台实现了对主键到相应Domain实例的转换。</p><p>当然，这里的User对象实现了Persistable接口，并已有相应的UserRepository extends <code>JpaRepository&lt;User>的实现。</code></p></li></ul><h3 id=excelview>ExcelView</h3><p>为了更好的支持Excel的导出功能，系统提供了ExcelView类结合ExcelUtils的Excel模板方式导出Excel。只要按照ExcelUtils的语法制作Excel模板，然后放在FreeMarker模板文件放置的目录中，在Controller中如下使用：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ModelAndView</span> <span style=color:#000>excel2</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>model</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;();</span>
    <span style=color:#000>model</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;变量&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ModelAndView</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ExcelView</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getRelativePath</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/so_master/excel&#34;</span><span style=color:#ce5c00;font-weight:700>)),</span> <span style=color:#000>model</span><span style=color:#ce5c00;font-weight:700>);</span>                   
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>上述代码将会去views/admin[front]/xxxx/so_master/目录下寻找excel.xls的Excel模板文件，然后通过ExcelUtils解析该模板文件生成需要的Excel文件。</p><h2 id=freemarker模板编写>Freemarker模板编写</h2><h3 id=页面布局>页面布局</h3><p>Macula 使用 FreeMarker 宏来规范ftl页面模板的开发：</p><ul><li><strong>后端默认布局界面编写</strong></li></ul><pre><code>&lt;@layout.mower_admin title=&quot;Dashboard&quot;&gt;
    具体业务内容
&lt;/@layout.mower_admin&gt;
</code></pre><ul><li><strong>前端默认界面布局编写：</strong></li></ul><pre><code>&lt;@layout.mower_front title=&quot;Dashboard&quot;&gt;
    &lt;@ui.main_breadcrumb rootType='front' menuCode=&quot;FRONT_TEST_MENU1&quot; /&gt;
    &lt;@ui.main_wrapper&gt;
        &lt;@ui.main_content&gt;
            Dashborad
        &lt;/@ui.main_content&gt;
    &lt;/@ui.main_wrapper&gt;
&lt;/@layout.mower_front&gt;
</code></pre><p><em><strong>重要</strong></em></p><p>布局可以根据是否AJAX请求自动判断是否输出javascript和css的脚本</p><h3 id=页面布局宏的定义>页面布局宏的定义</h3><p>我们先看看freemarker整个宏文件的定义逻辑：</p><p><img src=/imgs/v3.1/chapter2/layout_mower.png alt></p><p>在views根目录下，有个layout.ftl是整个布局宏的入口：</p><pre><code>&lt;#macro includeScripts scripts&gt;
    &lt;#if scripts?exists &amp;&amp; scripts != ''&gt;
        &lt;#list scripts?split(&quot;,&quot;) as jsItem&gt;
            &lt;script id=&quot;${jsItem?trim?replace('.', '_')?replace('/', '_')}&quot; type=&quot;text/javascript&quot;&gt;
                &lt;#include &quot;/${jsItem?trim?replace('.js', minVersion+'.js')}&quot; parse=false /&gt;
            &lt;/script&gt;
        &lt;/#list&gt;
    &lt;/#if&gt;
&lt;/#macro&gt;

&lt;#include &quot;/admin/layout.ftl&quot; /&gt;
&lt;#include &quot;/admin/layout_mower.ftl&quot; /&gt;
&lt;#include &quot;/front/layout_mower.ftl&quot; /&gt;
&lt;#include &quot;/mobile/layout_mower.ftl&quot; /&gt;
</code></pre><p>admin目录下，layout.ftl是macula2.0版本的界面布局，layout_mower.ftl是macula 3.0的布局宏定义，下面讲讲这个文件：</p><pre><code>&lt;#global resources_admin=&quot;${resourceHost!''}/resources/mower/${appVersion!''}/admin&quot; /&gt;
&lt;#global views_admin=&quot;${resourceHost!''}/views/mower/${appVersion!''}/admin&quot; /&gt;

&lt;#macro mower_admin_head title = '' require = ''&gt;
    meta、css等脚本定义        
&lt;/#macro&gt;

&lt;#macro mower_admin_header_logo&gt;
    ...
&lt;/#macro&gt;

&lt;#macro mower_admin_header_menu&gt;
    ...  
&lt;/#macro&gt;

&lt;#macro mower_admin_header_login&gt;
    ...
&lt;/#macro&gt;

&lt;#macro mower_admin_footer&gt;
    ...
&lt;/#macro&gt;

&lt;#macro mower_admin_scripts require = ''&gt;
    js引入定义
&lt;/#macro&gt;

&lt;!--给用户自定义宏的机会 --&gt;
&lt;#include &quot;/admin/app/layout_mower.ftl&quot; /&gt;

&lt;#macro mower_admin title scripts = '' version = '' require = ''&gt;
&lt;#global ui_name = 'mower' /&gt;
&lt;#global ui_path = 'admin' /&gt;
&lt;#if Request['isAjaxRequest']?exists &amp;&amp; Request['isAjaxRequest'] == true&gt;
    &lt;#if title?exists&gt;&lt;title&gt;${title?if_exists}&lt;/title&gt;&lt;/#if&gt;
    &lt;#if version?exists&gt;&lt;meta content=&quot;${(version?replace(&quot;(\\$)|(\\s\\$)|(Revision:\\s)&quot;, &quot;&quot;, &quot;r&quot;))?if_exists}-${appVersion!&quot;&quot;}&quot;&gt;&lt;/#if&gt;
    &lt;#nested /&gt;
    &lt;@includeScripts scripts /&gt;
&lt;#else&gt;
    &lt;!DOCTYPE html&gt;
    &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
    &lt;head&gt;
        &lt;@mower_admin_head title=&quot;${title?if_exists}&quot; require = &quot;${require!''}&quot; /&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            ...         
        &lt;/script&gt;
    &lt;/head&gt;

    &lt;body data-base=&quot;${base}&quot;&gt;

    &lt;noscript&gt;
        &lt;div class=&quot;noscript error&quot;&gt;
            您好，要正常运行应用程序，浏览器必须支持Javascript！
        &lt;/div&gt;
    &lt;/noscript&gt;

    &lt;!-- Loading Container --&gt;
    &lt;div class=&quot;loading-container&quot;&gt;
       &lt;div class=&quot;loader&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--  /Loading Container --&gt;    

    &lt;!-- BEGIN HEADER --&gt;
    &lt;div id=&quot;header&quot; class=&quot;mu-header-container&quot;&gt;
        &lt;!-- BEGIN MAIN MENU --&gt;
        &lt;div class=&quot;navbar&quot; role=&quot;navigation&quot;&gt;
            &lt;div class=&quot;navbar-inner&quot;&gt;
                &lt;div class=&quot;navbar-container&quot;&gt;
                    &lt;@mower_admin_header_logo /&gt;
                    &lt;!-- Sidebar Collapse --&gt;
                    &lt;div class=&quot;sidebar-collapse&quot; id=&quot;sidebar-collapse&quot;&gt;
                        &lt;i class=&quot;collapse-icon fa fa-bars&quot;&gt;&lt;/i&gt;
                    &lt;/div&gt;
                    &lt;!-- /Sidebar Collapse --&gt;
                    &lt;@mower_admin_header_menu /&gt;
                    &lt;@mower_admin_header_login /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- END HEADER --&gt;

    &lt;!-- BEGIN MAIN --&gt;
    &lt;div class=&quot;mu-main-container container-fluid&quot;&gt;
        &lt;!-- BEGIN SIDEBAR --&gt;
        &lt;div class=&quot;mu-sidebar-wrapper&quot;&gt;
            &lt;div class=&quot;mu-sidebar&quot; id=&quot;sidebar&quot;&gt;
                &lt;!-- Page Sidebar Header--&gt;
                &lt;div class=&quot;sidebar-header-wrapper&quot;&gt;
                    &lt;input type=&quot;text&quot; class=&quot;searchinput&quot;&gt;
                    &lt;i class=&quot;searchicon fa fa-search&quot;&gt;&lt;/i&gt;
                    &lt;div class=&quot;searchhelper&quot;&gt;搜索菜单&lt;/div&gt;
                &lt;/div&gt;
                &lt;!-- /Page Sidebar Header --&gt;
                &lt;!-- Sidebar Menu --&gt;
                &lt;ul class=&quot;nav sidebar-menu&quot; style=&quot;&quot;&gt;
                &lt;/ul&gt;
                &lt;!-- /Sidebar Menu --&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;!-- END SIDEBAR --&gt;    

        &lt;!-- BEGIN CONTENT --&gt;
        &lt;div class=&quot;mu-content-wrapper&quot;&gt;
            &lt;div class=&quot;mu-content&quot;&gt;
                &lt;!-- BEGIN BREADCRUMB --&gt;
                &lt;div class=&quot;mu-content-header&quot;&gt;
                    &lt;div class=&quot;mu-breadcrumb-wrapper&quot;&gt;
                        &lt;ul class=&quot;breadcrumb&quot; data-target=&quot;#mainContent&quot;&gt;
                            &lt;li data-target=&quot;breadcrumb0&quot; class=&quot;active&quot;&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;header-buttons&quot;&gt;
                        &lt;a class=&quot;sidebar-toggler&quot; href=&quot;#&quot;&gt;
                            &lt;i class=&quot;fa fa-arrows-h&quot;&gt;&lt;/i&gt;
                        &lt;/a&gt;
                        &lt;a class=&quot;refresh&quot; id=&quot;refresh-toggler&quot; href=&quot;&quot;&gt;
                            &lt;i class=&quot;glyphicon glyphicon-refresh&quot;&gt;&lt;/i&gt;
                        &lt;/a&gt;
                        &lt;a class=&quot;favorite&quot; id=&quot;favorite-toggler&quot; href=&quot;#&quot;&gt;
                            &lt;i class=&quot;fa fa-star fa-lg&quot;&gt;&lt;/i&gt;
                        &lt;/a&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;!-- END BREADCRUMB--&gt;
                &lt;div class=&quot;mu-content-body&quot;&gt;
                    &lt;div class=&quot;row&quot;&gt;
                        &lt;div class=&quot;col-md-12&quot;&gt;
                            &lt;div id=&quot;mainContent&quot;&gt;
                                &lt;div data-panel=&quot;breadcrumb0&quot;&gt;
                                    &lt;#nested /&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;        
    &lt;/div&gt;
    &lt;!-- END MAIN --&gt;

    &lt;!-- BEGIN FOOTER --&gt;
    &lt;div id=&quot;footer&quot; class=&quot;mu-footer&quot;&gt;
        &lt;@mower_admin_footer /&gt;
    &lt;/div&gt;
    &lt;!-- END FOOTER --&gt;

    &lt;@mower_admin_scripts require = &quot;${require!''}&quot; /&gt;

    &lt;!-- BEGIN PAGE LEVEL SCRIPTS --&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;${resources_admin}/app/js/config${minVersion!&quot;&quot;}.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;${resources_admin}/app/js/app${minVersion!&quot;&quot;}.js&quot;&gt;&lt;/script&gt;

    &lt;@includeScripts scripts=&quot;admin/app/layout_mower.js&quot; /&gt;
    &lt;@includeScripts scripts=&quot;ui/app/ui.js&quot; /&gt;
    &lt;@includeScripts scripts /&gt;
    &lt;!-- END PAGE LEVEL SCRIPTS --&gt;
    &lt;/body&gt;
    &lt;/html&gt;
&lt;/#if&gt;
&lt;/#macro&gt;
</code></pre><p><em><strong>提示</strong></em><br>&lt;@layout.mower_admin title scripts = &lsquo;页面脚本&rsquo; version = '' require = &lsquo;angularjs/knockoutjs/vue&rsquo;></p><p>&lt;/@layout.mower_admin></p><ul><li><p>scripts是您的页面对应的脚本，路径以views下面的目录为准</p></li><li><p>title 页面标题</p></li><li><p>version 页面版本</p></li><li><p>require 要引入的MVC JS文件，支持angularjs、knockoutjs、vue</p></li></ul><p>这个宏是业务页面的主要的宏，一般情况下，不要脱离这个宏做页面，这样未来修改时可以整体替换。</p><h3 id=后端页面布局定制>后端页面布局定制</h3><p>下面我们以后台管理页面为例进行讲解。后台管理页面布局如下图所示：</p><p><img src=/imgs/v3.1/chapter2/macula-layout.png alt=macula-layout></p><p>由上图可见，Macula 页面由 header，main container 和 footer 三部分组成。其中，header 由 logo，menu 和 login 组成；main container 主要包括 sidebar 和 content 两大部分；footer 构成比较简单。</p><p>为了方便大家理解，我们以一个实际的页面为例子说明各个部分。</p><p><img src=/imgs/v3.1/chapter2/macula-layout-demo.png alt=macula-layout-demo></p><p>开发者可以通过修改自己项目中的如下这个文件来自定义自己的 header logo，header menu，header login 和 footer。</p><p>app目录中的layout_mower.ftl文件可以覆盖，同时会重新定义admin/layout_mower.ftl中的相关宏。</p><p>我们来看一下admin/app目录下的这个文件里面的内容：</p><pre><code>&lt;#--
使用者可以通过覆盖这个文件实现对一些宏的重新定义包括：
-- html head中的内容，包括meta css等
&lt;#macro mower_admin_head title = ''&gt;
-- LOGO
&lt;#macro mower_admin_header_logo&gt;
-- 菜单栏
&lt;#macro mower_admin_header_menu&gt;
-- 登录后提示信息
&lt;#macro mower_admin_header_login&gt;
-- 页脚
&lt;#macro mower_admin_footer&gt;
包含的Javascript(angularjs,knockoutjs,datagrid)
&lt;#macro mower_admin_scripts require = ''&gt;
--&gt;

&lt;#--
局部替换：如果以下变量定义在具体业务模板中，则会覆盖你的layout模板中的定义

&lt;#global mower_admin_scripts_addition&gt;
    加入你自己的javascript库文件
&lt;/#global&gt;

&lt;#global mower_admin_head_addition&gt;
    加入你自己的css文件
&lt;/#global&gt;
--&gt;
</code></pre><p>由上面的代码可见，我们可以通过修改宏 mower_admin_header_logo 来自定义自己的 header logo；同样道理我们可以通过修改宏 mower_admin_header_menu，mower_admin_header_login，以及 mower_admin_footer 来分别定义自己的 header menu，header login 和 footer。</p><h3 id=前端页面布局定制>前端页面布局定制</h3><p>与后端定制类似，front/app/layout_mower.ftl文件提供了前端布局定制功能：</p><pre><code>&lt;#--
使用者可以通过覆盖这个文件实现对一些宏的重新定义包括：
--html head中的内容，包括css meta等
&lt;#macro mower_front_head title = ''&gt;
--页面的最上端
&lt;#macro mower_front_header_login&gt;
--广告
&lt;#macro mower_front_header_ad&gt;
--LOGO
&lt;#macro mower_front_header_logo&gt;
--菜单栏
&lt;#macro mower_front_header_menu&gt;
--页脚
&lt;#macro mower_front_footer&gt;
--包含的Javascript(angularjs,knockoutjs,datagrid)
&lt;#macro mower_front_scripts require = ''&gt;
--&gt;


&lt;#--
局部替换：如果以下变量定义在具体业务模板中，则会覆盖你的layout模板中的定义

-- 定义最顶的登录状态条最左边显示的文字内容
&lt;#global mower_front_header_login_custom_left&gt;
    文字
&lt;/#global&gt;

-- 定义最顶的登录状态条最右边显示的文字内容
&lt;#global mower_front_header_login_custom_right&gt;
    &lt;li&gt;
        &lt;a target=&quot;_blank&quot; href=&quot;#&quot;&gt;&lt;i class=&quot;fa fa-sitemap&quot;&gt;&lt;/i&gt;网站导航&lt;/a&gt;
    &lt;/li&gt;
&lt;/#global&gt;

定制广告头
&lt;#global mower_front_header_ad_custom&gt;

&lt;/#global&gt;

定制LOGO区域
&lt;#global mower_front_header_logo_custom&gt;

&lt;/#global&gt;

定制整个菜单区域
&lt;#global mower_front_header_menu_custom&gt;
xxxxx
&lt;/#global&gt;

定制默认菜单的右边区域
&lt;#global mower_front_header_menu_custom_right&gt;
    &lt;li&gt;&lt;a href=&quot;xxx&quot;&gt;xxx&lt;/a&gt;&lt;/li&gt;
&lt;/#global&gt;

定制页脚区域
&lt;#global mower_front_footer_custom&gt;
ddddadf
&lt;/#global&gt;

&lt;#global mower_front_scripts_addition&gt;
    加入你自己的javascript库文件
&lt;/#global&gt;

&lt;#global mower_front_head_addition&gt;
    加入你自己的css文件
&lt;/#global&gt;
--&gt;
</code></pre><h3 id=ui宏>UI宏</h3><p>u目录的ui.ftl提供了框架默认的UI宏，包括：</p><pre><code>&lt;#-- UI的自定义宏 --&gt;
&lt;#---------------------------------------ADMIN---------------------------------------&gt;
&lt;#macro panel id='panel-list' class='panel panel-widget unboxed'&gt;

&lt;/#macro&gt;

&lt;#macro panel_head&gt;

&lt;/#macro&gt;

&lt;#macro panel_body&gt;

&lt;/#macro&gt;

&lt;#macro panel_footer&gt;

&lt;/#macro&gt;

&lt;#macro panel_toolbar_query&gt;

&lt;/#macro&gt;

&lt;#macro panel_toolbar_advanced_query&gt;

&lt;/#macro&gt;
&lt;#------------------------------FRONT-------------------------------------&gt;
&lt;#macro main_breadcrumb rootType = 'admin' menuCode = ''&gt;
&lt;!-- BEGIN BREADCRUMB --&gt;

&lt;!-- END BREADCRUMB--&gt;
&lt;/#macro&gt;

&lt;#macro main_sidebar&gt;

&lt;/#macro&gt;

&lt;#macro main_content&gt;

&lt;/#macro&gt;

&lt;#macro main_wrapper&gt;

&lt;/#macro&gt;
&lt;#----------------------------------------COMMON---------------------------------&gt;
&lt;#include &quot;/ui/app/ui.ftl&quot; /&gt;
</code></pre><p>典型的后端页面是：</p><pre><code>&lt;@layout.mower_admin title='' scripts=''&gt;
&lt;@ui.panel&gt;
    &lt;@ui.panel_head&gt;
    工具条
    &lt;/@ui.panel_head&gt;
    &lt;@ui.panel_body&gt;
    内容
    &lt;/@ui.panel_body&gt;
&lt;/@ui.panel&gt;
&lt;/@layout.mower_admin&gt;
</code></pre><p>典型的前端页是：</p><pre><code>&lt;@layout.mower_front title=&quot;Dashboard&quot;&gt;
    &lt;@ui.main_breadcrumb rootType='front' menuCode=&quot;FRONT_TEST_MENU1&quot; /&gt;
    &lt;@ui.main_wrapper&gt;
        &lt;@ui.main_content&gt;
            Dashborad
        &lt;/@ui.main_content&gt;
    &lt;/@ui.main_wrapper&gt;
&lt;/@layout.mower_front&gt;
</code></pre><p>你可以覆盖ui/app/ui.ftl和ui.js来定义你的UI宏。</p><h4 id=高级查询自动关联>高级查询自动关联</h4><p>这个以一个例子来说明。如下图所示，有一个根据名称和编码的快捷查询，在其右侧还有一个高级查询，点击高级查询按钮，dropdown里面的查询条件更丰富一些。用户在快捷查询中的名称、编码填了内容后，发现当前条件还没能筛选出满意的内容，当他点击高级查询时，在高级查询dropdown里的相应字段（菜单名称、编码）的内容会用快捷查询的相应内容自动填充，并把它们的值关联起来。</p><p><img src=/imgs/v3.1/chapter2/advquery-004.png alt></p><p>这个主要是通过框架中定义的panel_toolbar_query和panel_toolbar_advanced_query这两个宏实现的。两个宏中的input元素通过id进行value的关联。程序会遍历panel_toolbar_query中的input元素的id，然后在panel_toolbar_advanced_query找到前缀为advanced_query_相应的id进行关联。如下例中的id分别为“name”和“advanced_query_name”的两个元素。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#a40000>&lt;</span>@ui.panel_toolbar_query&gt;
    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-inline&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-search&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>名称<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>编码<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>a</span> <span style=color:#c4a000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;#&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;search-submit-action-${code}&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;btn btn-default btn-sm&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;fa fa-search&#34;</span><span style=color:#000;font-weight:700>&gt;&lt;/</span><span style=color:#204a87;font-weight:700>i</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>a</span><span style=color:#000;font-weight:700>&gt;</span>
    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>&gt;</span>
<span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_query&gt;
<span style=color:#a40000>&lt;</span>@ui.panel_toolbar_advanced_query&gt;
    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-horizontal&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-advanced-search&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-body&#34;</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;width: 420px; height: 280px; padding: 10px 30px 0 0; text-align: right;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-group row&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;col-md-4&#34;</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;padding-top: 5px&#34;</span><span style=color:#000;font-weight:700>&gt;</span>菜单名称<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;col-md-8&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
                    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span>  <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-control input-sm&#34;</span> <span style=color:#c4a000>maxlength</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;50&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;advanced_query_name&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>/&gt;</span>
                <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
            <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
…
…
<span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_advanced_query&gt;
</code></pre></div><p>另外，panel_toolbar_advanced_query有个参数“customDivId”,可以让我们把高级查询的内容放到一个自定义的div里而不是默认的dropdown中，当点击“高级查询”时div会自动toggle，相应的字段也会关联。</p><p><img src=/imgs/v3.1/chapter2/advquery-005.png alt></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class </span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;row&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#a40000>&lt;</span>@ui.panel_toolbar_query&gt;
            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-inline&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-search&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>名称<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>编码<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>a</span> <span style=color:#c4a000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;#&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;search-submit-action-${code}&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;btn btn-default btn-sm&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
                    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;fa fa-search&#34;</span><span style=color:#000;font-weight:700>&gt;&lt;/</span><span style=color:#204a87;font-weight:700>i</span><span style=color:#000;font-weight:700>&gt;</span>
                <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>a</span><span style=color:#000;font-weight:700>&gt;</span>
            <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>&gt;</span>
        <span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_query&gt;
        <span style=color:#a40000>&lt;</span>@ui.panel_toolbar_advanced_query customDivId=&#34;myDiv&#34;&gt;
        <span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_advanced_query&gt;
    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;myDiv&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
…
…
<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</code></pre></div><h2 id=前端开发框架>前端开发框架</h2><p>Macula 使用 Mower 作为前端开发框架。有关 Mower 的详细介绍请访问 <a href=http://macula.top/mower/>Mower 官方网站</a>。</p><h2 id=macula宏>Macula宏</h2><p>为了方便开发，框架内置了一些常用的macula宏给freemarker使用</p><h3 id=权限判断>权限判断</h3><p>在freemarker中，如果需要通过权限控制是否显示内容，如下：</p><pre><code>&lt;@macula.preAuthorized url method&gt;
有权限的显示
&lt;/@macula.preAuthorized&gt;
&lt;@macula.notAuthorized url method&gt;
没有权限的显示
&lt;/@macula.notAuthorized&gt;
</code></pre><h3 id=下拉框>下拉框</h3><p>我们先来看看Macula中下拉框的样子，如下图绿色方框中所示：</p><p><img src=/imgs/v3.1/chapter2/macula_select.png alt=macula\_select></p><p>要实现下拉框首先需要有下拉框选项。下拉框的选项是静态的情形很简单，在这里我们讨论的是下拉框中的选项是从数据库中获取的。我们知道下拉框的选项由 name 和 value两项组成。在这里，我们需要用到 Macula 的数据参数功能。我们可以在数据参数中定义这些选项。数据参数中定义的选项有三种形式。</p><ol><li><p>典型的形式如下：</p><pre><code>name1:value1|name2:value2|...
</code></pre><p>例如：</p><pre><code>NONE:不缓存|SESSION:整个用户Session作用域|INSTANCE:实例级作用域|APPLICATION:全局级别作用域
</code></pre></li><li><p>如果选项的 name 和 value 相同，还可以简化成以下的形式：</p><pre><code>name1|name2|...
</code></pre><p>例如：</p><pre><code>String|Integer|Long|Double|Boolean|Timestamp|Date|Word
</code></pre></li><li><p>当然还可以用 SQL 的形式从数据库中获取。例如：</p><pre><code>!select app_name as label, app_id as code from ma_base_application
</code></pre></li></ol><p>有关数据参数的详细介绍，请参阅“基础插件”中的“数据提供”一节。</p><p>下面我们来看下如何在 ftl 中定义下拉框：</p><pre><code>&lt;div class=&quot;form-group&quot;&gt;
    &lt;label class=&quot;control-label col-md-3&quot;&gt;所属应用：&lt;/label&gt;
    &lt;div class=&quot;col-md-9&quot;&gt;
        &lt;select name=&quot;dataParam.appId&quot; data-bind=&quot;options: appIdParams.application_list, optionsText: 'label', optionsValue:'code', optionsCaption: '请选择', value: appId &quot;  class=&quot;chosen-select form-control&quot;/&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre><p>上面的例子中用到了 knockoutJs 的 data-bind，通过 options 属性将一个名为 appIdParams.application_list 的 js 变量绑定到下拉框的选项中，而 appIdParams.application_list 中的内容正是来自于预先定义好的数据参数 application_list。在同一个 ftl 中我们使用 Macula 框架提供的宏 writeDataParamsJs 获取数据参数 application_list 的内容。如下：</p><pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
    var appIdParams={&lt;@macula.writeDataParamsJs 'application_list' /&gt;};
&lt;/script&gt;
</code></pre><p>数据参数 application_list 的定义如下：</p><pre><code>select app_name as label, app_id as code from ma_base_application
</code></pre><p><em><strong>提示：</strong></em></p><p><em><strong>&lt;@macula.writeDataParamsJs &lsquo;xxx&rsquo;/>可以通过逗号分隔多个参数，如果同一个界面有多个参数可以通过这种方式一次获取参数。</strong></em></p><h3 id=避免重复提交的token>避免重复提交的Token</h3><pre><code>&lt;@macula.formToken captcha=&quot;true/false&quot; /&gt;
</code></pre><p>上述代码放入表单中，则会自动生成防止重复提交的token，如果要显示验证码，captcha输入true。</p><h2 id=freemarker内置变量>FreeMarker内置变量</h2><p>macula框架通过扩展freemarker提供了一些内置变量和方法给Freemarker模板使用。</p><h3 id=登录用户信息>登录用户信息</h3><p>变量userPrincipal：代表用户登陆后的凭据。</p><p>登录用户信息在登录时，我们可以通过实现 CustomUserLoginRepository 接口把用户信息放到UserPincipal的atrribute中，可以在Freemarker中通过如下获取，Freemaker中的userPrincipal对应UserPrincipal类：</p><pre><code>&lt;#if userPrincipal.getAttributeValue(&quot;userInfo&quot;)?exists&gt;
  &lt;#assign userInfo = userPrincipal.getAttributeValue(&quot;userInfo&quot;)&gt;
&lt;/#if&gt;

&lt;#if userInfo?exists&gt;

&lt;#else&gt;

&lt;/#if&gt;

&lt;!--当前用户名--&gt;
${userPrincipal.getName()！&quot;&quot;}
&lt;!--当前用户姓名--&gt;
${userPrincipal.getNickname()!&quot;&quot;}
</code></pre><h3 id=菜单变量>菜单变量</h3><p>macula框架在Freemarker中默认有如下变量：</p><ul><li><p>后端</p><ul><li><p>adminRootMenu ：后端根菜单</p></li><li><p>adminMainMenu：父亲是根的二级菜单</p></li></ul></li><li><p>前端</p><ul><li><p>frontRootMenu：前端根菜单</p></li><li><p>frontMainMenu：父亲是根的二级菜单</p></li></ul></li><li><p>移动端</p><ul><li><p>mobileRootMenu：移动端根菜单</p></li><li><p>mobileMainMenu：父亲是根的二级菜单</p></li></ul></li></ul><p>获取绝对地址方法</p><h3 id=freemarker内置方法>Freemarker内置方法</h3><ul><li><p>getDataParams(dataParamCode) 返回FieldOption类型的code/value参数列表；</p></li><li><p>getMenuBreadcrumb(rootType, menuCode) 返回指定菜单的面包屑结构菜单，参考ui宏</p></li><li><p>hasAccess(url, method) 返回指定的url和method是否可以访问</p></li><li><p>getAbsoluteUrl(base, url, default) 返回url的绝对路径，如果url不是以http/https开头，会自动加上base</p></li></ul><h2 id=国际化>国际化</h2><p>国际化 可分为页面国际化和提示信息国际化。</p><p>页面国际化可以通过多个Freemarker文件解决，通过不同的国际化后缀来区分不同地区的页面；比如：index.ftl，如果要添加一个英文页面，可以添加index_en_US.ftl，这样当英文国家的用户访问系统时，将最先使用index_en_US.ftl文件。</p><p>提示信息国际化使用资源文件处理，在每个模块的资源文件目录下，都有i18n/xxxx/messages_xx_XX.properties等众多资源文件，同时添加到applicationContext-app.xml配置文件中。</p><h2 id=地址规划>地址规划</h2><p>对于当前大部分的业务系统，存在终端使用和后台管理的情况以及未来对于F5在地址分发方面的合理性布局，在地址规划上，需要按一定的规则进行：</p><ul><li>/admin ：如果该功能是一个后台管理功能，则需要在地址前端加入/admin</li><li>/front：如果该功能是一个用户使用功能，则需要在地址前端加入/front/</li><li>/模块名/：针对macula平台开发的需要，每个模块都必须有自己的地址命名空间，对于该部分的命名，需要在模块定义规划时指定（具体的模块命名可能需要进行流程方面的审批）。</li><li>/功能名称/：针对模块下的某一功能，需要给出功能的名称。</li><li>/操作名称/：针对某一功能下具体的操作，需要给出操作的名称，如index,new,edit,save,read,delete,query等动词。</li></ul><p>所以最终的地址命名为：</p><ul><li>管理功能：/admin/模块名/功能名/操作名称/参数/其他</li><li>用户功能：/front/模块名/功能名/操作名称/参数/其他</li></ul><h2 id=请求方式规划>请求方式规划</h2><p>为了保证业务系统不被重复的请求以及不正确的请求干扰，对于请求方式做如下规划：</p><ul><li>对于获取单条数据或显示新增与编辑页面的方式可以使用GET请求</li><li>对于删除数据、保存数据或提交多条数据给后台的应该使用POST方式</li><li>有多个查询条件的查询功能应该使用POST方式</li></ul><h2 id=restful-api>RESTful API</h2><p>在对REST的支持方面，使用Spring的REST解决方案，macula平台提供@OpenApi注解替换@ResponseBody注解，这里说明在能使用REST的方式下，尽量使用REST方式。</p><p>在Macula平台开发中，将不通过地址中的参数来传递参数值，而直接通过地址信息来传递参数值。</p><p>如请求的地址：/admin/macula-uim/user/delete/user1 可通过Controller中定义</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/admin/macula-uim/user/delete/{userName}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RequestMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DELETE</span><span style=color:#ce5c00;font-weight:700>)</span>
<span style=color:#5c35cc;font-weight:700>@OpenApi</span>
<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExecuteResponse</span> <span style=color:#000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@PathVariable</span> <span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>//do something
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><h3 id=rest数据返回格式>REST数据返回格式</h3><p>为了未来能够将目前的Controller请求方法开放给其他终端使用，有必要对Controller的返回值做一个统一的规划，如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Response</span> <span style=color:#ce5c00;font-weight:700>{</span>

    <span style=color:#8f5902;font-style:italic>/** 是否成功标识 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>success</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 系统级错误代码 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>errorCode</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#8f5902;font-style:italic>/** 系统级错误信息 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>errorMessage</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 业务级错误代码 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>exceptionCode</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#8f5902;font-style:italic>/** 业务级错误信息 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>exceptionMessage</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 异常详细信息 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>exceptionStack</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#8f5902;font-style:italic>/** 服务端重定向信息 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>redirection</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 校验结果信息 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>FieldError</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>validateErrors</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Response</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>success</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>

    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Response</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>MaculaException</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>success</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>;</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>errorCode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getParentCode</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>errorMessage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ApplicationContext</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>errorMessage</span><span style=color:#ce5c00;font-weight:700>);</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exceptionCode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exceptionMessage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLocalizedMessage</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exceptionStack</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getFullStackMessage</span><span style=color:#ce5c00;font-weight:700>();</span>

        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>exception</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>FormBindException</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>FieldError</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>fieldErrors</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>((</span><span style=color:#000>FormBindException</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getFieldErrors</span><span style=color:#ce5c00;font-weight:700>();</span>
            <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>FieldError</span> <span style=color:#000>fieldError</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>fieldErrors</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
                <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addValidateError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>fieldError</span><span style=color:#ce5c00;font-weight:700>);</span>
            <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ExecuteResponse</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Response</span> <span style=color:#ce5c00;font-weight:700>{</span>

    <span style=color:#8f5902;font-style:italic>/** 结果信息 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>T</span> <span style=color:#000>returnObject</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExecuteResponse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>returnObject</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>

    <span style=color:#8f5902;font-style:italic>/**
</span><span style=color:#8f5902;font-style:italic>     * @return the result
</span><span style=color:#8f5902;font-style:italic>     */</span>
    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>T</span> <span style=color:#000>getReturnObject</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>returnObject</span><span style=color:#ce5c00;font-weight:700>;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>

<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>PageResponse</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Response</span> <span style=color:#ce5c00;font-weight:700>{</span>

    <span style=color:#8f5902;font-style:italic>/** 本次请求的记录数 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>size</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 当前页码，从零开始 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>number</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 总记录数 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>totalElements</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 总页数 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>totalPages</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 本页的总记录数 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>numberOfElements</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 是否首页 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>firstPage</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 是否最后页 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>lastPage</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#8f5902;font-style:italic>/** 内容列表 */</span>
    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;?&gt;</span> <span style=color:#000>content</span><span style=color:#ce5c00;font-weight:700>;</span>

    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>PageResponse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;?&gt;</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSize</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getNumber</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>totalElements</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTotalElements</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>totalPages</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTotalPages</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>numberOfElements</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getNumberOfElements</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>firstPage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isFirstPage</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>lastPage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isLastPage</span><span style=color:#ce5c00;font-weight:700>();</span>
        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>content</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getContent</span><span style=color:#ce5c00;font-weight:700>();</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>上述代码中，Response类是基类，出现异常时会构造Response类型返回，ExecuteResponse主要用在单记录数据的返回，PageResponse则用于需要返回列表数据的情况。</p><p><em><strong>重要</strong></em></p><p><em>为了减少对编程的干扰，正常情况下，Controller中的方法可以仍然按照Service接口中的方法的返回值正常返回数据，对于原使用@ResponseBody注解的方法，如果需要，则通过使用@OpenApi注解来自动处理对应的返回值，默认情况下，采用@OpenApi 注解后，非Response、Map、Model等类型的返回值，会被包裹成ExecuteResponse，而Page&lt;?>返回值会被包裹成PageResponse。</em></p><p>@OpenApi注解的启用需要配置RequestMappingHandlerAdapter的customReturnValueHandlers属性：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customReturnValueHandlers&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
    <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.OpenApiReturnValueHandler&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
            <span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;messageConverters&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>              
        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
    <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</code></pre></div><h2 id=heading></h2><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">最后修改 May 1, 2021: <a href=https://github.com/macula-projects/macula-projects.github.io/commit/49ca01d528a2a3e8198087e03f4382d097170df7>add content (49ca01d)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/google/docsy><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 The Macula Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>隐私政策</a></small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>